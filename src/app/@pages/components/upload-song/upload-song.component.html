<section class="scrollable container-upload padder-lg w-f-md" id="bjax-target">
  <mat-tab-group color="transparent" animationDuration="0ms" backgroundColor="">
    <div class="mat-elevation-z4">
      <mat-tab label="Upload Song" [aria-label]="'accent'">
        <!-- Form Upload Song -->
        <form style="margin-top: 20px" method="post" [formGroup]="uploadSongFormGroup" #uploadSongForm="ngForm"
          (ngSubmit)="onUploadSong(uploadSongForm)" id="formUploadHidden" enctype="multipart/form-data" novalidate
          class="box has-advanced-upload">
          <div style="border: 1px dashed #fff;" appDragDropFileUpload (fileDropped)="upload($event)"
            class="upload-song">
            <div *ngIf="!songFileArr.length || songFileArr.length !== 1 " class="box__input">
              <input #songFileField (change)="upload($event.target.files)" type="file" name="file"
                id="inputUploadHidden" class="box__file"
                accept=".mp3,.wma,.mp2,.asf,.wav,.wmv,.mp4,.flv,.mpg,.mpe,.avi,.3gp,.dat,.flac">
              <div class="icon_upload_v3">
              </div>
              <div class="title_upload_v3">
                Chọn file để tải lên
              </div>
              <div class="desc_upload_v3">
                Bạn có thể kéo và thả file tại đây
              </div>
            </div>
            <div *ngIf="songFileArr.length === 1" class="box-upload">
              <b>Đã tải lên {{ songFileArr.length }} mục</b>
              <div class="row song-uploading">
                <div class="col-md-12 pr-md-1">
                  <div class="file_box">
                    <div class="row">
                      <div class="avatar_small_upload">
                        <img width="50" height="50" id="avatar_small_upload">
                        <div class="title_small_upload">
                          {{ songFile.name.length > 50 ? songFile.name.slice(0, 50).concat("... ", songFile.name.slice(songFile.name.lastIndexOf('.'))) : songFile.name  }}
                          <span style="color: #b1b1b1; margin-left: 20px">
                            {{ (songFile.size / 1000000).toFixed(2) }}MB&nbsp;&nbsp;
                            <button type="button" (click)="onRemoveTrack(0)"
                              style="border: none; background-color: transparent; color: rgba(255, 255, 255, 0.541); border-radius: 5px;">x</button>
                          </span>
                        </div>
                        <div class="info_small_upload">ư
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <mat-divider></mat-divider>
          <div class="song-info">
            <div class="container row">
              <div class="col-md-12">
                <div class="card">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-12 pr-md-1">
                        <div class="form-group">
                          <mat-form-field class="example-chip-list" appearance="none">
                            <label>
                              Album
                            </label>
                            <mat-chip-list #albumList>
                              <mat-chip *ngFor="let album of albums; let index=index" [selectable]="selectableAlbum"
                                [removable]="removableAlbum" (removed)="removeAlbum(index)">
                                {{album.name}}
                                <mat-icon matChipRemove *ngIf="removableAlbum">cancel</mat-icon>
                              </mat-chip>
                              <input #albumInput [formControl]="albumCtrl" [matAutocomplete]="autoAlbum"
                                [matChipInputFor]="albumList" [matChipInputSeparatorKeyCodes]="separatorKeysCodesAlbum"
                                [matChipInputAddOnBlur]="addOnBlurAlbum" (matChipInputTokenEnd)="addAlbum($event)">
                            </mat-chip-list>
                            <mat-autocomplete #autoAlbum="matAutocomplete" (optionSelected)="selectedAlbum($event)">
                              <ng-container *ngFor="let album of filteredAlbums | async">
                                <mat-option *ngIf="!albums.includes(album)" [value]="album">
                                  {{album.name}}
                                </mat-option>
                              </ng-container>
                            </mat-autocomplete>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 pr-md-1">
                        <div class="form-group">
                          <label>
                            Tên bài hát
                          </label>
                          <input [(ngModel)]="trackUpload.name" name="name" placeholder="Tên bài hát" type="text"
                            formControlName="name" class="form-control" />
                          <div *ngIf="name.invalid && (name.dirty || name.touched)" class="help-block">
                            <div *ngIf="name.errors.required">
                              Vui lòng nhập tên bài hát.
                            </div>
                            <div *ngIf="name.errors.minlength">
                              Tên bài hát phải có ít nhất 4 kí tự.
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 pr-md-1">
                        <div class="form-group">
                          <mat-form-field class="example-chip-list" appearance="none">
                            <label>
                              Ca sĩ, diễn viên
                            </label>
                            <mat-chip-list formControlName="singersFormControl" name="singersFormControl" #singerList>
                              <mat-chip *ngFor="let singer of singers; let index=index" [selectable]="selectableSinger"
                                [removable]="removableSinger" (removed)="removeSinger(index)">
                                {{singer.nickName}}
                                <mat-icon matChipRemove *ngIf="removableSinger">cancel</mat-icon>
                              </mat-chip>
                              <input #singerInput [formControl]="singerCtrl" [matAutocomplete]="autoSinger"
                                [matChipInputFor]="singerList"
                                [matChipInputSeparatorKeyCodes]="separatorKeysCodesSinger"
                                [matChipInputAddOnBlur]="addOnBlurSinger" (matChipInputTokenEnd)="addSinger($event)">
                            </mat-chip-list>
                            <mat-autocomplete #autoSinger="matAutocomplete" (optionSelected)="selectedSinger($event)">
                              <ng-container *ngFor="let singer of filteredSingers | async">
                                <mat-option *ngIf="!singers.includes(singer)" [value]="singer">
                                  {{singer.nickName}}
                                </mat-option>
                              </ng-container>
                            </mat-autocomplete>

                          </mat-form-field>
                          <div class="help-block">
                            <mat-error
                              *ngIf="(singersFormControl.touched || singersFormControl.dirty) && singers.length === 0">
                              Vui lòng chọn ca sĩ.</mat-error>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 pr-md-1">
                        <div class="form-group">
                          <mat-form-field class="example-chip-list" appearance="none">
                            <label>
                              Sáng tác
                            </label>
                            <mat-chip-list formControlName="composersFormControl" #composerList>
                              <mat-chip *ngFor="let composer of composers; let index=index"
                                [selectable]="selectableComposer" [removable]="removableComposer"
                                (removed)="removeComposer(index)">
                                {{composer.nickName}}
                                <mat-icon matChipRemove *ngIf="removableComposer">cancel</mat-icon>
                              </mat-chip>
                              <input #composerInput [formControl]="composerCtrl" [matAutocomplete]="autoComposer"
                                [matChipInputFor]="composerList"
                                [matChipInputSeparatorKeyCodes]="separatorKeysCodesComposer"
                                [matChipInputAddOnBlur]="addOnBlurComposer"
                                (matChipInputTokenEnd)="addComposer($event)">
                            </mat-chip-list>
                            <mat-autocomplete #autoComposer="matAutocomplete"
                              (optionSelected)="selectedComposer($event)">
                              <ng-container *ngFor="let composer of filteredComposers | async">
                                <mat-option *ngIf="!composers.includes(composer)" [value]="composer">
                                  {{composer.nickName}}
                                </mat-option>
                              </ng-container>
                            </mat-autocomplete>
                          </mat-form-field>
                          <div class="help-block">
                            <mat-error
                            *ngIf="(composersFormControl.touched || composersFormControl.dirty) && composers.length === 0">
                            Vui lòng chọn nhà sáng tác.</mat-error>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-4 pr-md-1">
                        <div class="form-group">
                          <label>
                            Chuyên mục
                          </label>
                          <select class="form-control select-category"
                            [(ngModel)]="trackUpload.category" formControlName="category">
                            <option [ngValue]="null" disabled>Chọn chuyên mục</option>
                            <option *ngFor="let category of listCategory" [ngValue]="category"> {{ category.name }}
                            </option>
                          </select>
                          <div *ngIf="trackUpload.category.id === undefined && category.touched" class="help-block">
                            Vui lòng chọn chuyên mục nhạc.
                          </div> 
                        </div>
                      </div>
                      <div class="col-md-8 pl-md-1">
                        <div class="form-group">
                          <mat-form-field class="example-chip-list" appearance="none">
                            <label>
                              Thể loại
                            </label>
                            <mat-chip-list formControlName="genresFormControl" #genreList>
                              <mat-chip *ngFor="let genre of genres; let index=index" [selectable]="selectableGenre"
                                [removable]="removableGenre" (removed)="removeGenre(index)">
                                {{genre.name}}
                                <mat-icon matChipRemove *ngIf="removableGenre">cancel</mat-icon>
                              </mat-chip>
                              <input #genreInput [formControl]="genreCtrl" [matAutocomplete]="autoGenre"
                                [matChipInputFor]="genreList" [matChipInputSeparatorKeyCodes]="separatorKeysCodesGenre"
                                [matChipInputAddOnBlur]="addOnBlurGenre" (matChipInputTokenEnd)="addGenre($event)">
                            </mat-chip-list>
                            <mat-autocomplete #autoGenre="matAutocomplete" (optionSelected)="selectedGenre($event)">
                              <ng-container *ngFor="let genre of filteredGenres | async">
                                <mat-option *ngIf="!genres.includes(genre)" [value]="genre">
                                  {{genre.name}}
                                </mat-option>
                              </ng-container>
                            </mat-autocomplete>
                          </mat-form-field>
                          <div class="help-block">
                            <mat-error
                              *ngIf="(genresFormControl.touched || genresFormControl.dirty) && genres.length === 0">Vui
                              lòng chọn thể loại.</mat-error>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6 pr-md-1">
                        <div class="form-group">
                          <label>
                            Hãng sản xuất
                          </label>
                          <input [(ngModel)]="trackUpload.musicProduction" name="musicProduction" type="text"
                            class="form-control" />
                        </div>
                      </div>
                      <div class="col-md-6 pl-md-1">
                        <div class="form-group">
                          <label>
                            Năm phát hành
                          </label>
                          <input [(ngModel)]="trackUpload.musicYear" name="musicYear" type="number"
                            class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 pr-md-1">
                        <div class="form-group">
                          <label>
                            Lời bài hát
                          </label>
                          <textarea rows="5" [(ngModel)]="trackUpload.lyric" name="lyric"
                            class="text-area form-control"></textarea>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 pr-md-1">
                        <div class="form-group">
                          <label>
                            Ghi chú
                          </label>
                          <input [(ngModel)]="trackUpload.description" name="description" type="text"
                            class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div style="justify-content: center;" class="card-footer row">
                      <button type="submit" class="btn btn-fill btn-danger">
                        <i *ngIf="showLoading" class="fa fa-spinner"></i>
                        <span *ngIf="showLoading"> Uploading...</span>
                        <span *ngIf="!showLoading" class="m-r-n-lg">Upload</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- <div class="col-md-4">
                <div class="card card-user">
                  <div class="author">
                    <div class="card-footer">
                      <div id="avatar_big_upload">
                        <label (click)="onUploadImage()" id="labelImageInputUpload" for="fileAvatar">
                        </label>
                        <input type="file" accept="image/*" (change)="onImageChange($event)" name="imageFile"
                          id="imageFile" style="display: none;">
                      </div>
                    </div>
                  </div>
                </div>
              </div> -->
            </div>
          </div>

        </form>
        <!-- End Form Upload Song -->
      </mat-tab>
    </div>
    <div class="mat-elevation-z4">
      <mat-tab label="Upload Album">
        <!-- Form Upload Album -->
        <form style="margin-top: 20px" method="post" [formGroup]="uploadAlbumFormGroup" #uploadAlbumForm="ngForm"
          (ngSubmit)="onUploadAlbum(uploadAlbumForm)" id="formUploadHidden" enctype="multipart/form-data" novalidate
          class="box has-advanced-upload">
          <div style="border: 1px dashed #fff;" appDragDropFileUpload (fileDropped)="upload($event)"
            class="upload-song">
            <div *ngIf="!songFileArr.length" class="box__input">
              <input #songFileField (change)="upload($event.target.files)" type="file" name="file"
                id="inputUploadHidden" class="box__file" multiple
                accept=".mp3,.wma,.mp2,.asf,.wav,.wmv,.mp4,.flv,.mpg,.mpe,.avi,.3gp,.dat,.flac">
              <div class="icon_upload_v3">
              </div>
              <div class="title_upload_v3">
                Chọn file để tải lên
              </div>
              <div class="desc_upload_v3">
                Bạn có thể kéo và thả file tại đây
              </div>
            </div>
            <div *ngIf="songFileArr.length" class="box-upload">
              <b>Đã tải lên {{ songFileArr.length }} mục</b>
              <div *ngFor="let songFile of songFileArr; let index=index" class="row song-uploading">
                <div class="col-md-12 pr-md-1">
                  <div class="file_box">
                    <div class="row">
                      <div class="avatar_small_upload">
                        <img width="50" height="50" id="avatar_small_upload">
                        <div class="title_small_upload">
                          {{ songFile.item.name.length > 50 ? songFile.item.name.slice(0, 50).concat("... ", songFile.item.name.slice(songFile.item.name.lastIndexOf('.'))) : songFile.item.name  }}
                          <span style="color: #b1b1b1; margin-left: 20px">
                            {{ (songFile.item.size / 1000000).toFixed(2) }}MB &nbsp;&nbsp;
                            <button type="button" (click)="onRemoveTrack(index)"
                              style="border: none; background-color: transparent; color: rgba(255, 255, 255, 0.541); border-radius: 5px;">x</button>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div style="color: rgba(255, 255, 255, 0.541); text-align: center; font-size: 13px; margin-top: 15px">
            <i>Bạn có thể upload nhiều bài hát cùng lúc bằng cách nhấn giữ phím Ctrl và click chọn các files.</i>
          </div>
          <mat-divider></mat-divider>
          <div class="song-info">
            <div class="container row">
              <div class="col-md-8">
                <div class="card">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-12 pr-md-1">
                        <div class="form-group">
                          <label>
                            Tên album
                          </label>
                          <input name="name" [(ngModel)]="albumUpload.name" formControlName="name" placeholder="Tên album" type="text"
                            class="form-control" />
                          <div *ngIf="nameAlbum.invalid && (nameAlbum.dirty || nameAlbum.touched)" class="help-block">
                            <div *ngIf="nameAlbum.errors.required">
                              Vui lòng nhập tên album.
                            </div>
                            <div *ngIf="nameAlbum.errors.minlength">
                              Tên album phải có ít nhất 4 kí tự.
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 pr-md-1">
                        <div class="form-group">
                          <mat-form-field class="example-chip-list" appearance="none">
                            <label>
                              Ca sĩ, diễn viên
                            </label>
                            <mat-chip-list formControlName="singersFormControl" name="singersFormControl" #singerList>
                              <mat-chip *ngFor="let singer of singers; let index=index" [selectable]="selectableSinger"
                                [removable]="removableSinger" (removed)="removeSinger(index)">
                                {{singer.nickName}}
                                <mat-icon matChipRemove *ngIf="removableSinger">cancel</mat-icon>
                              </mat-chip>
                              <input #singerInput [formControl]="singerCtrl" [matAutocomplete]="autoSinger"
                                [matChipInputFor]="singerList"
                                [matChipInputSeparatorKeyCodes]="separatorKeysCodesSinger"
                                [matChipInputAddOnBlur]="addOnBlurSinger" (matChipInputTokenEnd)="addSinger($event)">
                            </mat-chip-list>
                            <mat-autocomplete #autoSinger="matAutocomplete" (optionSelected)="selectedSinger($event)">
                              <ng-container *ngFor="let singer of filteredSingers | async">
                                <mat-option *ngIf="!singers.includes(singer)" [value]="singer">
                                  {{singer.nickName}}
                                </mat-option>
                              </ng-container>
                            </mat-autocomplete>

                          </mat-form-field>
                          <div class="help-block">
                            <mat-error
                              *ngIf="(singersAlbumFormControl.touched || singersAlbumFormControl.dirty) && singers.length === 0">
                              Vui lòng chọn ca sĩ.</mat-error>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 pr-md-1">
                        <div class="form-group">
                          <label>
                            Chuyên mục
                          </label>
                          <select class="form-control select-category"
                            [(ngModel)]="trackUpload.category" formControlName="category">
                            <option [ngValue]="null" disabled>Chọn chuyên mục</option>
                            <option *ngFor="let category of listCategory" [ngValue]="category"> {{ category.name }}
                            </option>
                          </select>
                          <div *ngIf="trackUpload.category.id === undefined && categoryAlbum.touched" class="help-block">
                            Vui lòng chọn chuyên mục nhạc.
                          </div> 
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 pr-md-1">
                        <div class="form-group">
                          <mat-form-field class="example-chip-list" appearance="none">
                            <label>
                              Thể loại
                            </label>
                            <mat-chip-list formControlName="genresFormControl" #genreList>
                              <mat-chip *ngFor="let genre of genres; let index=index" [selectable]="selectableGenre"
                                [removable]="removableGenre" (removed)="removeGenre(index)">
                                {{genre.name}}
                                <mat-icon matChipRemove *ngIf="removableGenre">cancel</mat-icon>
                              </mat-chip>
                              <input #genreInput [formControl]="genreCtrl" [matAutocomplete]="autoGenre"
                                [matChipInputFor]="genreList" [matChipInputSeparatorKeyCodes]="separatorKeysCodesGenre"
                                [matChipInputAddOnBlur]="addOnBlurGenre" (matChipInputTokenEnd)="addGenre($event)">
                            </mat-chip-list>
                            <mat-autocomplete #autoGenre="matAutocomplete" (optionSelected)="selectedGenre($event)">
                              <ng-container *ngFor="let genre of filteredGenres | async">
                                <mat-option *ngIf="!genres.includes(genre)" [value]="genre">
                                  {{genre.name}}
                                </mat-option>
                              </ng-container>
                            </mat-autocomplete>
                          </mat-form-field>
                          <div class="help-block">
                            <mat-error
                              *ngIf="(genresAlbumFormControl.touched || genresAlbumFormControl.dirty) && genres.length === 0">Vui
                              lòng chọn thể loại.</mat-error>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 pr-md-1">
                        <div class="form-group">
                          <label>
                            Năm phát hành
                          </label>
                          <input [(ngModel)]="albumUpload.musicYear" formControlName="musicYear" name="musicYear" type="number"
                            class="form-control" />
                          <div *ngIf="musicYear.invalid && (musicYear.dirty || musicYear.touched)" class="help-block">
                            <div *ngIf="musicYear.errors.required">
                              Vui lòng nhập năm phát hành.
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 pr-md-1">
                        <div class="form-group">
                          <label>
                            Hãng sản xuất
                          </label>
                          <input [(ngModel)]="albumUpload.musicProduction" formControlName="musicProduction" name="musicProduction" type="text"
                            class="form-control" />
                          <div *ngIf="musicProduction.invalid && (musicProduction.dirty || musicProduction.touched)" class="help-block">
                            <div *ngIf="musicProduction.errors.required">
                              Vui lòng nhập hãng sản xuất.
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div style="justify-content: center;" class="card-footer row">
                      <!-- <button (click)="onCancelUploadAlbumSong()" type="button" class="btn btn-fill btn-danger">
                        <span class="m-r-n-lg">Cancel</span>
                      </button> -->
                      <button type="submit" class="btn btn-fill btn-danger">
                        <i *ngIf="showLoading" class="fa fa-spinner"></i>
                        <span *ngIf="showLoading"> Uploading...</span>
                        <span *ngIf="!showLoading" class="m-r-n-lg">Upload</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card card-user">
                  <div class="author">
                    <div class="card-footer">
                      <div id="avatar_big_upload">
                        <label (click)="onUploadAlbumImage()" id="labelImageInputUpload" for="fileAvatar">
                        </label>
                        <input type="file" accept="image/*" (change)="onAlbumImageChange($event)" name="albumImageFile"
                          id="albumImageFile" style="display: none;">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
        <!-- End Form Upload Album -->
      </mat-tab>
    </div>
  </mat-tab-group>
</section>
